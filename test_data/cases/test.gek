name ct10;

fn () {
    if (GetActiveMenuMode() != 1023) {
        return;
    }

    array mpNameToEditorId = Ar_Construct("stringmap");
    Ar_ForEach(GetQuests(), fn (array iter) {
        string edid = GetEditorId(iter[0]);
        string qname = $iter[0];

        mpNameToEditorId[qname] = edid;
    });

    array tracked = Call(CompileScript("SQL\GetTracked.txt"), 1);
    for (int i = 0; i < GetUIFloat("MapMenu/GLOW_BRANCH/MM_MainRect/MM_QuestsList/childcount"); i++) {
        string questPath = "MapMenu/GLOW_BRANCH/MM_MainRect/MM_QuestsList/MM_ListItem:" + $i;
        if (!IsComponentLoaded(questPath)) {
            return;
        }

        string questName = GetUiString(questPath + "/ListItemText/string");
        if (!Ar_HasKey(mpNameToEditorId, questName)) {
            i++;
            return;
        }

        string editorId = mpNameToEditorId[questName];
        if (IsFormValid(GetActiveQuest())) {
            if ($GetEditorId(GetActiveQuest()) != editorId) {
                SetUIFloatAlt(questPath + "/MM_Template_ItemMarker/visible", Ar_HasKey(tracked, editorId));
            } else {
                SetUIFloatAlt(questPath + "/MM_Template_ItemMarker/visible", 1);
            }
        } else {
            SetUIFloatAlt(questPath + "/MM_Template_ItemMarker/visible", Ar_HasKey(tracked, editorId));
        }
    }
}
